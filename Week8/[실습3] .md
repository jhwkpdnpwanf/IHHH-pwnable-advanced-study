# Exploit Tech: Bypass IO_validate_vtable

**Ubuntu 18.04 64-bit(Glibc 2.27) 실습 환경 Dockerfile**

```docker
FROM ubuntu:18.04
ENV PATH="${PATH}:/usr/local/lib/python3.6/dist-packages/bin"
ENV LC_CTYPE=C.UTF-8
RUN apt update
RUN apt install -y \
    gcc \
    git \
    python3 \
    python3-pip \
    ruby \
    sudo \
    tmux \
    vim \
    wget
# install pwndbg
WORKDIR /root
RUN git clone https://github.com/pwndbg/pwndbg
WORKDIR /root/pwndbg
RUN git checkout 2023.03.19
RUN ./setup.sh
# install pwntools
RUN pip3 install --upgrade pip
RUN pip3 install pwntools
# install one_gadget command
RUN gem install one_gadget -v 1.6.2
# install patchelf
WORKDIR /root
RUN apt install -y dh-autoreconf
RUN git clone https://github.com/NixOS/patchelf
WORKDIR /root/patchelf
RUN git checkout 0.17.2
RUN ./bootstrap.sh
RUN ./configure
RUN make
RUN make check
RUN sudo make install
WORKDIR /root
```

```bash
CONTAINER_NAME=my_container; \
docker build . -t ubuntu1804; \
docker run -d -t --privileged --name=$CONTAINER_NAME ubuntu1804; \
docker exec -it -u root $CONTAINER_NAME bash
```

**bypass_valid_vtable.c**

```c
#include <stdio.h>
#include <unistd.h>

FILE *fp;

void init() {
  setvbuf(stdin, 0, 2, 0);
  setvbuf(stdout, 0, 2, 0);
}
int main() {
  init();

  fp = fopen("/dev/urandom", "r");

  printf("stdout: %p\n", stdout);
  printf("Data: ");

  read(0, fp, 300);

  fclose(fp);
}
```

**코드 분석**

전 문제와 비슷한 문제이다. 다른점은 w 가 아닌 r 읽기 모드로 열고, 이번엔 read_flag 같은 함수가 없다는 것이다.  
대신 stdout 의 주소를 주면서 libc 베이스의 주소를 주는 걸 봐선 쉘을 실행시키는 함수를 부르는 문제로 예상이 간다.    

read 에서 fp 를 조작할 수 있으니까 IO 테이블과 vtable 을 조작하면 될 것 같다.   

<br>

**동적 분석**

